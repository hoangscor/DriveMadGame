<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>Drive Mad ULTRA – Campaign + Store + Daily + Editor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="page">

  <header class="header">
    <div class="header-left">
      <h1 class="game-title">Drive Mad ULTRA</h1>
      <p class="subtitle">
        Campaign • Stars • BestTime • Wallet/Store • Daily Endless + Daily Challenge/Quest • Ghost/Replay • Achievements • Editor • Custom Levels • Local Leaderboard • Jump • Flip • Upside 3s
      </p>
    </div>
    <div class="header-right">
      <span class="status-dot"></span>
      <span class="status-text">VS Code • Live Server</span>
    </div>
  </header>

  <main class="main">
    <section class="card">
      <div class="card-header">
        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
        <span class="card-title">Drive Mad ULTRA (index.html)</span>
      </div>

      <div class="card-body">
        <div id="game-wrapper">
          <canvas id="gameCanvas" width="1280" height="720"></canvas>
          <canvas id="minimapCanvas" width="280" height="64"></canvas>

          <!-- HUD TOP -->
          <div id="hud-top">
            <div class="hud-left">
              <button id="btnMenu" class="btn small secondary">Menu</button>
              <button id="btnRestart" class="btn small">Restart (R)</button>
              <button id="btnPause" class="btn small secondary">Pause (P)</button>
              <button id="btnReplayBest" class="btn small secondary">Replay Best</button>
              <button id="btnReplayLast" class="btn small secondary">Replay Last</button>
              <button id="btnStore" class="btn small secondary">Store</button>
              <button id="btnLevels" class="btn small secondary">Levels</button>
              <button id="btnEditor" class="btn small secondary">Editor</button>
            </div>

            <div class="hud-center">
              <span id="hudMode" class="pill">PLAY</span>
              <span id="hudLevelName" class="pill alt">LEVEL</span>
              <span id="hudStars" class="pill tiny alt">★☆☆</span>
            </div>

            <div class="hud-right">
              <span class="hud-pill">Time: <span id="hudTime">0.0</span>s</span>
              <span class="hud-pill">Speed: <span id="hudSpeed">0</span> km/h</span>
              <span class="hud-pill">Lives: <span id="hudLives">4</span></span>
              <span class="hud-pill">Nitro: <span id="hudNitro">100%</span></span>
              <span class="hud-pill">Fuel: <span id="hudFuel">100%</span></span>
              <span class="hud-pill">Run Coins: <span id="hudCoins">0</span></span>
              <span class="hud-pill">Wallet: <span id="hudWallet">0</span></span>
              <span class="hud-pill">Score: <span id="hudScore">0</span></span>

              <button id="btnFullscreen" class="btn tiny secondary">⛶</button>
              <button id="btnSettings" class="btn tiny secondary">⚙</button>
              <button id="btnStats" class="btn tiny secondary">Stats</button>
              <button id="btnHelp" class="btn tiny secondary">Help</button>
              <button id="btnSound" class="btn tiny secondary">SFX: ON</button>
            </div>
          </div>

          <!-- TOUCH CONTROLS -->
          <div id="touchControls">
            <button id="btnLeft" class="circle-btn">⟵</button>
            <button id="btnRight" class="circle-btn">⟶</button>
            <div class="touch-right-group">
              <button id="btnJump" class="circle-btn jump">⤴</button>
              <button id="btnNitro" class="circle-btn nitro">⚡</button>
            </div>
          </div>

          <!-- MENU PANEL -->
          <div id="menuPanel" class="panel">
            <div class="panel-inner wide">
              <h2>Drive Mad ULTRA</h2>
              <p class="muted">
                Campaign có sao & unlock level, Store mua skin bằng Wallet coins, Daily Endless + Daily Challenge/Quest theo seed mỗi ngày,
                Editor tạo custom level, Local Leaderboard, Ghost/Replay, Achievements. Bản này có <b>Jump</b> + <b>flip nhào lộn</b> và
                chỉ thua khi xe bị nằm ngửa trên đường ≥ 3 giây (hoặc rơi khỏi map / đâm hazard / hết xăng).
              </p>

              <div class="grid-2">
                <div class="box">
                  <h3>Tóm tắt điều khiển</h3>
                  <ul class="panel-list">
                    <li>Trái/Phải: A/D hoặc ⟵/⟶</li>
                    <li>Nitro: Shift hoặc nút ⚡ (mobile)</li>
                    <li><b>Jump:</b> Space / W / ⟰ hoặc nút ⤴ (mobile)</li>
                    <li>Pause: P • Restart: R</li>
                    <li>Replay Best/Last để xem lại (Best có ghost)</li>
                    <li>Fullscreen: nút ⛶</li>
                    <li>Thua khi: rơi khỏi map / đâm hazard / hết xăng / xe nằm ngửa ≥ 3 giây.</li>
                  </ul>
                </div>

                <div class="box">
                  <h3>Các chế độ</h3>
                  <ul class="panel-list">
                    <li><b>PLAY (Campaign)</b>: có đích, chấm sao, unlock level tiếp theo.</li>
                    <li><b>DAILY ENDLESS</b>: endless seed theo ngày, áp dụng Daily Modifiers + Quest + Local leaderboard.</li>
                    <li><b>CUSTOM</b>: level tự tạo bằng Editor, có thể chơi & lưu nhiều cái.</li>
                  </ul>
                </div>
              </div>

              <div class="menu-actions">
                <button id="btnPlayCampaign" class="btn big">Chơi Campaign</button>
                <button id="btnPlayDaily" class="btn big secondary">Chơi Daily Endless</button>
                <button id="btnOpenLevels" class="btn big secondary">Chọn Level</button>
                <button id="btnOpenStore" class="btn big secondary">Mở Store</button>
                <button id="btnOpenEditor" class="btn big secondary">Mở Editor</button>
              </div>

              <div class="hint">
                Store: Coins nhặt trong run sẽ cộng vào Wallet khi kết thúc run (win/lose).<br/>
                Campaign: cần ít nhất 1★ để mở level kế tiếp. Các level đầu đã được làm dễ hơn để bạn có thể thắng được.<br/>
                Daily: xem Daily Challenge, Quest & Local Leaderboard tại Stats & Achievements → Daily.
              </div>
            </div>
          </div>

          <!-- LEVELS PANEL -->
          <div id="levelPanel" class="panel hidden">
            <div class="panel-inner wide">
              <h2>Levels</h2>
              <p class="muted">Campaign (Default) • Daily • Custom (Editor)</p>

              <div class="tabs">
                <button id="tabDefault" class="tab active">Campaign</button>
                <button id="tabDaily" class="tab">Daily</button>
                <button id="tabCustom" class="tab">Custom</button>
              </div>

              <div id="levelList" class="level-grid"></div>

              <div class="row">
                <button id="btnCloseLevels" class="btn full secondary">Đóng</button>
              </div>
            </div>
          </div>

          <!-- SETTINGS PANEL -->
          <div id="settingsPanel" class="panel hidden">
            <div class="panel-inner">
              <h2>Cài đặt</h2>

              <div class="setting-row">
                <label for="difficultySelect">Độ khó:</label>
                <select id="difficultySelect">
                  <option value="easy">Dễ</option>
                  <option value="normal" selected>Bình thường</option>
                  <option value="hard">Khó</option>
                </select>
              </div>

              <div class="setting-row">
                <label for="toggleGhost">Ghost (Best run):</label>
                <input type="checkbox" id="toggleGhost" checked />
              </div>

              <div class="setting-row">
                <label for="toggleEngine">Engine sound:</label>
                <input type="checkbox" id="toggleEngine" checked />
              </div>

              <div class="setting-row">
                <label for="toggleTilt">Tilt steering (mobile):</label>
                <input type="checkbox" id="toggleTilt" />
              </div>

              <div class="setting-row">
                <label for="tiltSensitivity">Tilt sensitivity:</label>
                <input id="tiltSensitivity" type="range" min="0.5" max="3" step="0.1" value="1.2" />
              </div>

              <button id="btnCloseSettings" class="btn full secondary">Đóng</button>
            </div>
          </div>

          <!-- STORE PANEL (Skins shop) -->
          <div id="storePanel" class="panel hidden">
            <div class="panel-inner wide">
              <h2>Store (Skins)</h2>
              <p class="muted">Mua skin bằng Wallet coins. Skin đã mua dùng vĩnh viễn.</p>

              <div class="store-top">
                <div class="store-pill">Wallet: <b><span id="storeWallet">0</span></b> coins</div>
                <div class="store-pill">Tip: thắng campaign được bonus coins theo sao + Daily Quest thưởng thêm Wallet.</div>
              </div>

              <div id="storeGrid" class="store-grid"></div>

              <div class="row">
                <button id="btnCloseStore" class="btn secondary">Đóng</button>
              </div>
            </div>
          </div>

          <!-- HELP PANEL -->
          <div id="helpPanel" class="panel hidden">
            <div class="panel-inner wide">
              <h2>Hướng dẫn sử dụng & cách thắng</h2>
              <p class="muted">
                Bảng này dành cho người chơi mới hoặc quay lại sau 1 thời gian. Bao gồm: điều khiển, cách thắng,
                giải thích các chế độ, Wallet/Store, Daily, Ghost/Replay, Editor, Achievements & Local Leaderboard.
              </p>

              <div class="grid-2">
                <div class="box">
                  <h3>1. Điều khiển (PC)</h3>
                  <ul class="panel-list">
                    <li><b>Trái / Phải:</b> A / D hoặc ← / → (lái & xoay xe).</li>
                    <li><b>Jump:</b> Space / W / ↑ – nhảy.\</li>
                    <li><b>Nitro:</b> Shift trái/phải – tăng tốc mạnh.</li>
                    <li><b>Pause:</b> P • <b>Restart:</b> R.</li>
                    <li><b>Fullscreen:</b> nút ⛶ ở góc HUD.</li>
                  </ul>

                  <h3>2. Điều khiển (Điện thoại)</h3>
                  <ul class="panel-list">
                    <li>Nút ⟵ / ⟶: lái trái/phải & điều chỉnh góc khi xe đang bay.</li>
                    <li>Nút ⤴: nhảy.</li>
                    <li>Nút ⚡: nitro.</li>
                    <li>Có tuỳ chọn Tilt (nghiêng máy) trong Settings.</li>
                  </ul>
                </div>

                <div class="box">
                  <h3>3. Cách thắng & khi nào thua</h3>
                  <ul class="panel-list">
                    <li><b>Campaign:</b> chạy tới cột đích, dừng xe lại (tốc độ thấp) để thắng.</li>
                    <li><b>Daily Endless:</b> không có đích – cố gắng đi xa nhất.</li>
                    <li><b>Thua khi:</b>
                      <ul>
                        <li>Rơi khỏi map (rơi sâu xuống dưới).</li>
                        <li>Đâm vào hazard (cọc đỏ).</li>
                        <li>Hết xăng và xe dừng hẳn.</li>
                        <li><b>Xe nằm ngửa (úp bụng lên trời) liên tục ≥ 3 giây
                          khi chạm đường.</b></li>
                      </ul>
                    </li>
                    <li>Có thể flip nhào lộn thoải mái trên không – chỉ cần không nằm ngửa quá lâu khi tiếp đất.</li>
                  </ul>
                </div>
              </div>

              <div class="grid-2">
                <div class="box">
                  <h3>4. Các chế độ chơi</h3>
                  <ul class="panel-list">
                    <li><b>PLAY (Campaign):</b> bộ level cố định, mỗi level có:
                      <ul>
                        <li>Par Time (thời gian chuẩn).</li>
                        <li>Sao (★): 1–3 tuỳ theo thời gian hoàn thành.</li>
                        <li>Hoàn thành ≥1★ → mở level tiếp theo.</li>
                      </ul>
                    </li>
                    <li><b>DAILY ENDLESS:</b>
                      <ul>
                        <li>Map sinh ra theo seed ngày (YYYYMMDD).</li>
                        <li>Daily Modifiers (buff/nerf) hiển thị trong Stats.</li>
                        <li>Daily Quests: nhiệm vụ ngày, nhận thưởng vào Wallet.</li>
                        <li>Local Leaderboard: lưu 10–20 run tốt nhất trên máy.</li>
                      </ul>
                    </li>
                    <li><b>CUSTOM:</b> các level do bạn tạo trong Editor.</li>
                  </ul>
                </div>

                <div class="box">
                  <h3>5. Wallet, Coins, Store</h3>
                  <ul class="panel-list">
                    <li><b>Run Coins:</b> coins nhặt trong mỗi run (chỉ tính cho run đó).</li>
                    <li><b>Wallet:</b> tổng coins tích luỹ dùng để mua skin trong Store.</li>
                    <li>Sau mỗi run (thắng hoặc thua):
                      <ul>
                        <li>Run Coins + Bonus (tùy mode) → cộng vào Wallet.</li>
                        <li>Thắng Campaign: bonus thêm theo số sao.</li>
                        <li>Daily: bonus theo quãng đường.</li>
                      </ul>
                    </li>
                    <li><b>Store:</b>
                      <ul>
                        <li>Mua skin xe vĩnh viễn (không mất khi restart game).</li>
                        <li>Chọn skin đang dùng (Equip).</li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="grid-2">
                <div class="box">
                  <h3>6. Ghost, Replay & Stats</h3>
                  <ul class="panel-list">
                    <li><b>Ghost:</b> run tốt nhất của level Campaign (khi thắng).</li>
                    <li><b>Replay Best:</b> xem lại run tốt nhất (ghost).</li>
                    <li><b>Replay Last:</b> xem lại run vừa chơi.</li>
                    <li><b>Stats:</b> tổng quãng đường, số run, run coins, Wallet, crashes, best score, daily best distance.</li>
                  </ul>

                  <h3>7. Achievements</h3>
                  <ul class="panel-list">
                    <li>Mở Stats → Achievements để xem các mục tiêu.</li>
                    <li>Ví dụ: First Win, Coin Hunter, Rich, Crash Dummy, High Score, Daily Runner, Creator, Campaigner.</li>
                    <li>Mỗi Achievement mở khoá một lần và được lưu vĩnh viễn trong localStorage.</li>
                  </ul>
                </div>

                <div class="box">
                  <h3>8. Editor & Custom Levels</h3>
                  <ul class="panel-list">
                    <li><b>Terrain:</b> click thêm điểm, kéo để chỉnh, Shift+Click để xoá điểm.</li>
                    <li><b>Tool Coin/Hazard/Fuel/Checkpoint/Finish:</b> chọn tool rồi click đặt.</li>
                    <li><b>Erase:</b> click để xoá object gần vị trí click.</li>
                    <li><b>Snap/Grid:</b> bật/tắt snap & lưới.</li>
                    <li><b>Test:</b> chơi thử ngay trong Editor (không ảnh hưởng Campaign).</li>
                    <li><b>Save:</b> lưu thành 1 Custom Level, xuất hiện trong tab Custom.</li>
                    <li><b>Import/Export JSON:</b> copy/paste để chia sẻ level.</li>
                  </ul>
                </div>
              </div>

              <div class="row">
                <button id="btnCloseHelp" class="btn full secondary">Đóng hướng dẫn</button>
              </div>
            </div>
          </div>

          <!-- PAUSE PANEL -->
          <div id="pausePanel" class="panel hidden">
            <div class="panel-inner">
              <h2>Tạm dừng</h2>
              <p class="muted">Nhấn P hoặc bấm “Resume”.</p>
              <button id="btnResume" class="btn full">Resume</button>
            </div>
          </div>

          <!-- RESULT PANEL -->
          <div id="resultPanel" class="panel hidden">
            <div class="panel-inner">
              <h2 id="resultTitle"></h2>
              <div id="starRow" class="star-row"></div>
              <p id="resultText"></p>
              <p id="resultExtra" class="message-extra"></p>
              <button id="btnRetry" class="btn full">Chơi lại</button>
              <button id="btnNext" class="btn full secondary">Level tiếp</button>
            </div>
          </div>

          <!-- STATS PANEL -->
          <div id="statsPanel" class="panel hidden">
            <div class="panel-inner wide">
              <h2>Stats, Achievements & Daily</h2>

              <div class="grid-2">
                <div class="box">
                  <h3>Thống kê</h3>
                  <ul class="stats-list">
                    <li>Total runs: <span id="statsRuns">0</span></li>
                    <li>Total distance: <span id="statsDistance">0</span> m</li>
                    <li>Total run coins: <span id="statsCoins">0</span></li>
                    <li>Wallet coins: <span id="statsWallet">0</span></li>
                    <li>Total crashes: <span id="statsCrashes">0</span></li>
                    <li>Best score: <span id="statsBestScore">0</span></li>
                    <li>Daily best distance: <span id="statsDailyBest">0</span> m</li>
                  </ul>
                </div>

                <div class="box">
                  <h3>Achievements</h3>
                  <div id="achievements" class="ach-grid"></div>
                </div>
              </div>

              <div class="grid-2">
                <div class="box">
                  <h3>Daily Challenge & Quests</h3>
                  <div id="dailyChallengeSummary" class="daily-summary"></div>
                  <ul id="dailyQuestList" class="quest-list"></ul>
                  <button id="btnClaimDailyQuests" class="btn small full">
                    Nhận thưởng nhiệm vụ hoàn thành
                  </button>
                </div>

                <div class="box">
                  <h3>Daily Leaderboard (Local)</h3>
                  <div id="dailyLeaderboardInfo" class="daily-summary small"></div>
                  <ol id="dailyLeaderboard" class="leader-list"></ol>
                </div>
              </div>

              <div class="row">
                <button id="btnResetData" class="btn secondary">Reset Data</button>
                <button id="btnCloseStats" class="btn secondary">Đóng</button>
              </div>
            </div>
          </div>

          <!-- EDITOR PANEL -->
          <div id="editorPanel" class="panel hidden">
            <div class="panel-inner wide editor">
              <h2>Level Editor</h2>
              <p class="muted">
                Terrain: click thêm điểm, kéo để chỉnh, Shift+Click xóa điểm.
                Tool Coin/Hazard/Fuel/Checkpoint/Finish: click đặt. Erase: click xóa.
                Save để lưu vào Custom Levels.
              </p>

              <div class="editor-toolbar">
                <div class="tool-group">
                  <span class="tool-title">Tool:</span>
                  <button class="tool-btn active" data-tool="terrain">Terrain</button>
                  <button class="tool-btn" data-tool="coin">Coin</button>
                  <button class="tool-btn" data-tool="hazard">Hazard</button>
                  <button class="tool-btn" data-tool="fuel">Fuel</button>
                  <button class="tool-btn" data-tool="checkpoint">Checkpoint</button>
                  <button class="tool-btn" data-tool="finish">Finish</button>
                  <button class="tool-btn" data-tool="erase">Erase</button>
                </div>

                <div class="tool-group">
                  <span class="tool-title">Snap/Grid:</span>
                  <label class="toggle"><input type="checkbox" id="editorSnap" checked /><span>Snap</span></label>
                  <label class="toggle"><input type="checkbox" id="editorGrid" checked /><span>Grid</span></label>
                </div>

                <div class="tool-group">
                  <button id="btnEditorNew" class="btn small secondary">New</button>
                  <button id="btnEditorTest" class="btn small">Test</button>
                  <button id="btnEditorSave" class="btn small">Save</button>
                  <button id="btnEditorExport" class="btn small secondary">Export</button>
                  <button id="btnEditorImport" class="btn small secondary">Import</button>
                </div>
              </div>

              <div class="editor-row">
                <div class="editor-left">
                  <div class="field">
                    <label>Level name</label>
                    <input id="editorName" type="text" placeholder="My Custom Level" />
                  </div>

                  <div class="field">
                    <label>Start X</label>
                    <input id="editorStartX" type="number" min="0" value="80" />
                  </div>

                  <div class="field">
                    <label>Finish X</label>
                    <input id="editorFinishX" type="number" min="0" value="1100" />
                  </div>

                  <div class="field">
                    <label>Par time (seconds)</label>
                    <input id="editorParTime" type="number" min="5" value="35" />
                  </div>

                  <div class="field">
                    <label>Hint</label>
                    <div class="mini-hint">
                      Terrain: click/add • drag/move • Shift+Click delete (giữ ≥ 2 điểm).<br/>
                      Objects: click đặt • Erase: click xóa.
                    </div>
                  </div>

                  <div class="row">
                    <button id="btnEditorClose" class="btn full secondary">Đóng Editor</button>
                  </div>
                </div>

                <div class="editor-right">
                  <label class="muted">Import/Export JSON (copy/paste)</label>
                  <textarea id="editorJson" spellcheck="false"></textarea>
                </div>
              </div>

            </div>
          </div>

        </div>

        <pre class="code-block">
&lt;canvas id="gameCanvas"&gt;&lt;/canvas&gt;
&lt;script src="game.js"&gt;&lt;/script&gt;
        </pre>

      </div>
    </section>
  </main>

  <footer class="footer">
    <span>Drive Mad ULTRA • Campaign • Store • Daily Endless + Daily Challenge/Quest • Editor • Achievements • Local Leaderboard • Jump + Flip • Upside 3s</span>
  </footer>

</div>

<script src="game.js"></script>
</body>
</html>
